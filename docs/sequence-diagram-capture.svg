<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 600" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
    </marker>
    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1000" height="600" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="500" y="35" text-anchor="middle" font-size="18" font-weight="bold" fill="#1e293b">æ¶ˆæ¯æ•è·æ—¶åºå›¾ (Manual Capture Flow)</text>
  
  <!-- Actors -->
  <rect x="40" y="60" width="80" height="40" rx="6" fill="#10b981" stroke="#059669" stroke-width="2"/>
  <text x="80" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="600">Popup</text>
  
  <rect x="180" y="60" width="100" height="40" rx="6" fill="#ef4444" stroke="#dc2626" stroke-width="2"/>
  <text x="230" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="600">Background</text>
  
  <rect x="340" y="60" width="100" height="40" rx="6" fill="#6366f1" stroke="#4f46e5" stroke-width="2"/>
  <text x="390" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="600">Content.js</text>
  
  <rect x="500" y="60" width="100" height="40" rx="6" fill="#ec4899" stroke="#db2777" stroke-width="2"/>
  <text x="550" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="600">ChatGPT DOM</text>
  
  <rect x="660" y="60" width="100" height="40" rx="6" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
  <text x="710" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="600">Offscreen</text>
  
  <rect x="820" y="60" width="100" height="40" rx="6" fill="#8b5cf6" stroke="#7c3aed" stroke-width="2"/>
  <text x="870" y="85" text-anchor="middle" fill="white" font-size="12" font-weight="600">VS Code</text>
  
  <!-- Lifelines -->
  <line x1="80" y1="100" x2="80" y2="580" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,4"/>
  <line x1="230" y1="100" x2="230" y2="580" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,4"/>
  <line x1="390" y1="100" x2="390" y2="580" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,4"/>
  <line x1="550" y1="100" x2="550" y2="580" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,4"/>
  <line x1="710" y1="100" x2="710" y2="580" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,4"/>
  <line x1="870" y1="100" x2="870" y2="580" stroke="#94a3b8" stroke-width="2" stroke-dasharray="6,4"/>
  
  <!-- User Action Box -->
  <rect x="20" y="125" width="120" height="30" rx="4" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
  <text x="80" y="145" text-anchor="middle" fill="#92400e" font-size="11" font-weight="600">ğŸ‘† User clicks button</text>
  
  <!-- Step 1: Popup to Background -->
  <line x1="80" y1="170" x2="230" y2="170" stroke="#374151" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="155" y="162" text-anchor="middle" fill="#374151" font-size="10" font-weight="500">1. captureLastAssistant</text>
  
  <!-- Step 2: Background to Content -->
  <rect x="205" y="180" width="50" height="25" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <line x1="230" y1="205" x2="390" y2="205" stroke="#374151" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="310" y="197" text-anchor="middle" fill="#374151" font-size="10" font-weight="500">2. getLastAssistant</text>
  
  <!-- Step 3: Content queries DOM -->
  <rect x="365" y="215" width="50" height="25" fill="#e0e7ff" stroke="#6366f1" stroke-width="1"/>
  <line x1="390" y1="240" x2="550" y2="240" stroke="#6366f1" stroke-width="2" marker-end="url(#arrow-blue)"/>
  <text x="470" y="232" text-anchor="middle" fill="#4338ca" font-size="10" font-weight="500">3. querySelector('[data-message-author-role="assistant"]')</text>
  
  <!-- Step 4: DOM returns text -->
  <line x1="550" y1="265" x2="390" y2="265" stroke="#10b981" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrow-green)"/>
  <text x="470" y="257" text-anchor="middle" fill="#047857" font-size="10">4. textContent</text>
  
  <!-- Step 5: Content to Background -->
  <line x1="390" y1="290" x2="230" y2="290" stroke="#374151" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="310" y="282" text-anchor="middle" fill="#374151" font-size="10" font-weight="500">5. {ok:true, text:"..."}</text>
  
  <!-- Step 6: Background to Offscreen -->
  <rect x="205" y="300" width="50" height="25" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
  <line x1="230" y1="325" x2="710" y2="325" stroke="#374151" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="470" y="317" text-anchor="middle" fill="#374151" font-size="10" font-weight="500">6. offscreen_send(kind:"last_assistant", data:"...")</text>
  
  <!-- Step 7: Offscreen sends via WebSocket -->
  <rect x="685" y="335" width="50" height="25" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <line x1="710" y1="360" x2="870" y2="360" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-blue)"/>
  <text x="790" y="352" text-anchor="middle" fill="#1e40af" font-size="10" font-weight="500">7. WebSocket: browser_payload</text>
  
  <!-- Step 8: VS Code receives -->
  <rect x="845" y="370" width="50" height="70" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1"/>
  <text x="870" y="395" text-anchor="middle" fill="#6d28d9" font-size="9">onBrowser</text>
  <text x="870" y="410" text-anchor="middle" fill="#6d28d9" font-size="9">Payload</text>
  <text x="870" y="425" text-anchor="middle" fill="#6d28d9" font-size="9">callback</text>
  
  <!-- Step 9: Update Webview -->
  <rect x="800" y="455" width="140" height="35" rx="4" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
  <text x="870" y="470" text-anchor="middle" fill="#047857" font-size="10" font-weight="600">æ˜¾ç¤ºåœ¨ Bridge Panel</text>
  <text x="870" y="482" text-anchor="middle" fill="#047857" font-size="9">"Last Assistant: ..."</text>
  
  <!-- Response flow back -->
  <line x1="710" y1="395" x2="230" y2="395" stroke="#10b981" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrow-green)"/>
  <text x="470" y="387" text-anchor="middle" fill="#047857" font-size="10">8. {ok:true}</text>
  
  <line x1="230" y1="420" x2="80" y2="420" stroke="#10b981" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrow-green)"/>
  <text x="155" y="412" text-anchor="middle" fill="#047857" font-size="10">9. {ok:true, length:1234}</text>
  
  <!-- Success indicator in Popup -->
  <rect x="30" y="435" width="100" height="25" rx="4" fill="#d1fae5" stroke="#10b981" stroke-width="2"/>
  <text x="80" y="452" text-anchor="middle" fill="#047857" font-size="10" font-weight="600">âœ“ Sent 1234 chars</text>
  
  <!-- Legend -->
  <rect x="30" y="520" width="940" height="60" rx="6" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
  <text x="50" y="540" fill="#475569" font-size="11" font-weight="600">å›¾ä¾‹:</text>
  <line x1="100" y1="537" x2="150" y2="537" stroke="#374151" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="160" y="540" fill="#475569" font-size="10">è¯·æ±‚</text>
  <line x1="220" y1="537" x2="270" y2="537" stroke="#10b981" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrow-green)"/>
  <text x="280" y="540" fill="#475569" font-size="10">å“åº”</text>
  <line x1="340" y1="537" x2="390" y2="537" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrow-blue)"/>
  <text x="400" y="540" fill="#475569" font-size="10">WebSocket</text>
  <rect x="470" y="528" width="20" height="15" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
  <text x="500" y="540" fill="#475569" font-size="10">å¤„ç†ä¸­</text>
  <text x="50" y="565" fill="#64748b" font-size="10">âš ï¸ å…¨ç¨‹æ— è‡ªåŠ¨ç‚¹å‡» Sendï¼Œæ‰€æœ‰æ“ä½œç”±ç”¨æˆ·æ‰‹åŠ¨è§¦å‘</text>
</svg>

